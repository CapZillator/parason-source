import React, { useContext } from 'react';
import { AppContext } from '../store/context';
import { sunriseSunsetDayduration } from '../Lib';
import getLangPack from '../LangPack';
import '../styles/Chart.scss';

function SunChart(props: any) {
    const { state, dispatch } = useContext(AppContext);
    const lang = getLangPack(state.lang.code);
    
    let styleMain = 'Astro';
    if (props.size && props.size === 'small') styleMain = 'Astro-small';
    let polar = 0;
    let sunrise, sunset, dayDur, polarDay;
    
    if (state.weather.data){//Получаем астрономические данные
        const astronomy = sunriseSunsetDayduration(props.sunrise ? props.sunrise: state.weather.data.current.sunrise, props.sunset ? props.sunset: state.weather.data.current.sunset, lang.fullCode);
        polar = astronomy.polar;
        if (polar === 1){//Полярный день
            dayDur = '∞';
            polarDay = <g>
                    <text y='87%' className={'Astro-text'}>
                        <tspan x='50%' textAnchor='middle'>{lang.lib.chart.polar[polar - 1]}</tspan>   
                    </text>
                </g>;
        }
        else if (polar === 2){//Полярная ночь
            dayDur = '∞';
            polarDay = <g>
                    <text y='87%' className={'Astro-text'}>
                        <tspan x='50%' textAnchor='middle'>{lang.lib.chart.polar[polar - 1]}</tspan>   
                    </text>
                </g>;
        }
        else {
            sunrise = astronomy.sunrise;
            sunset = astronomy.sunset;
            dayDur = astronomy.dayDuration;
        }
    };

    const dayDur2 = '∞';
    return (
        <div className='Sunchart-wrapper'>
            <svg
                width={200}
                height={80}
                viewBox='0 0 52.917 21.167'
                className={styleMain}
            >
                <path className='Astro-chart-el'
                d='M10.789 1.876a.24.24 0 0 0-.098.028c-.105.054-.105.054-.114 1.113l-.007.977.081.07c.107.092.188.094.301.011l.08-.059v-.883c0-.486-.008-.943-.018-1.017-.015-.114-.026-.142-.076-.187a.206.206 0 0 0-.149-.053zm2.672 1.49a.19.19 0 0 0-.119.042c-.088.07-.474.883-.478 1.009-.002.07.052.155.122.19.086.045.17.03.235-.039.108-.115.429-.778.461-.953.026-.136-.097-.249-.22-.249zm-5.296.003a.285.285 0 0 0-.137.03c-.057.028-.115.115-.115.17 0 .117.389.936.48 1.013.068.057.194.067.256.02.055-.041.106-.127.107-.178 0-.089-.4-.937-.479-1.017-.023-.023-.066-.036-.112-.038zm-2.735.887a.28.28 0 0 0-.065.015.241.241 0 0 0-.169.225c0 .063.02.089.216.28.441.433 1.144 1.049 1.277 1.12.037.02.087.036.112.036.066.002.15-.067.175-.143.05-.15-.026-.24-.727-.87-.459-.413-.63-.56-.728-.624-.044-.03-.063-.04-.09-.04zm10.753.012c-.092 0-.108.013-.712.556-.703.633-.86.79-.86.872 0 .073.05.167.11.204a.204.204 0 0 0 .218 0c.113-.075 1.21-1.054 1.399-1.25.06-.061.071-.088.071-.154 0-.067-.011-.09-.074-.153-.062-.062-.087-.075-.152-.075zm-5.448.775c-.21 0-.412.016-.59.047-1.044.181-1.924.671-2.586 1.441-1.464 1.701-1.396 4.152.159 5.775.07.074.14.142.212.208h.75a3.847 3.847 0 0 1-1.571-2.158 4.04 4.04 0 0 1-.115-1.38c.025-.324.066-.523.174-.847a3.87 3.87 0 0 1 3.02-2.58c.36-.062 1.005-.044 1.42.04a3.939 3.939 0 0 1 1.53.708 3.885 3.885 0 0 1 1.395 2.162 3.9 3.9 0 0 1-.141 2.221 3.89 3.89 0 0 1-1.462 1.834h.753a4.325 4.325 0 0 0 1.292-2.135c.09-.348.105-.504.103-1.069-.002-.674-.045-.926-.25-1.48a4.306 4.306 0 0 0-4.093-2.787zm5.997 1.773a.32.32 0 0 0-.068.013 7.591 7.591 0 0 0-.79.31c-.168.084-.208.123-.223.217-.01.056-.002.082.04.138a.318.318 0 0 0 .094.085c.063.026.172.004.433-.09.469-.169.662-.261.7-.333.054-.106.015-.226-.099-.303-.04-.027-.059-.038-.087-.037zm-11.87.008c-.051 0-.079.024-.122.067-.121.121-.096.276.058.355.116.058.467.203.696.287.095.034.202.063.239.064.206.002.304-.243.149-.373-.075-.063-.158-.1-.621-.276-.226-.086-.332-.124-.398-.124zm-.391 2.295c-.766 0-.996.006-1.03.024-.11.064-.129.252-.034.347.049.05.055.05.399.06.192.006.643.013 1.003.015l.654.003.058-.062c.084-.089.106-.166.071-.25-.06-.142-.017-.137-1.121-.137zm12.95.014c-.521-.003-1.248.01-1.303.032-.062.023-.13.125-.13.195 0 .074.078.177.154.203.071.024 1.869.032 1.98.008a.183.183 0 0 0 .101-.079.228.228 0 0 0-.02-.283c-.047-.046-.064-.049-.362-.066a9.448 9.448 0 0 0-.42-.01zM5.764 11.08c-.087 0-.852.294-1.002.386-.127.077-.126.284.002.362.073.044.11.046.243.007.143-.042.654-.246.783-.312.113-.059.192-.152.192-.228 0-.067-.15-.215-.218-.215zm10.096.004a.223.223 0 0 0-.062.012c-.1.03-.144.098-.144.22 0 .08.008.1.059.145.066.06.39.202.706.31.23.08.375.094.445.045.06-.042.088-.159.057-.25-.028-.086-.087-.118-.549-.303-.353-.142-.448-.18-.512-.179zM42.693 6.101a.232.232 0 0 0-.13.027c-.105.054-.106.054-.114 1.113l-.008.977.082.07c.107.091.188.095.301.011l.08-.059v-.883c0-.486-.009-.944-.019-1.017-.014-.115-.025-.142-.075-.187a.206.206 0 0 0-.117-.052zm2.64 1.49a.19.19 0 0 0-.12.04c-.088.07-.473.884-.477 1.01-.002.07.052.155.122.19.086.045.17.031.235-.039.108-.115.429-.778.461-.953.026-.136-.098-.248-.222-.248zm-5.296.003a.285.285 0 0 0-.137.028c-.057.03-.115.116-.115.172 0 .115.389.935.48 1.012.068.057.194.068.256.02.055-.04.106-.127.106-.178 0-.089-.399-.938-.478-1.017-.023-.023-.066-.036-.112-.037zm-2.72.886c-.02-.003-.041.003-.08.015a.24.24 0 0 0-.169.225c0 .063.02.088.216.28.441.432 1.144 1.05 1.277 1.12a.32.32 0 0 0 .112.036c.066.001.15-.067.175-.143.05-.15-.026-.24-.727-.87-.459-.413-.63-.56-.728-.624a.208.208 0 0 0-.075-.04zm10.738.013c-.093 0-.109.012-.713.555-.703.632-.86.791-.86.873 0 .072.05.165.11.202a.205.205 0 0 0 .218 0c.114-.075 1.21-1.054 1.4-1.249.059-.062.07-.087.07-.153 0-.067-.01-.092-.073-.154-.062-.062-.088-.074-.152-.074zm-5.449.774c-.21 0-.413.016-.59.047-1.044.181-1.924.672-2.586 1.441a4.341 4.341 0 0 0-.92 1.749h.482l.047-.152a3.87 3.87 0 0 1 3.02-2.578c.361-.063 1.005-.045 1.42.04a3.937 3.937 0 0 1 1.53.707 3.888 3.888 0 0 1 1.345 1.983h.492a4.944 4.944 0 0 0-.146-.45 4.307 4.307 0 0 0-4.094-2.787zm6.013 1.774a.216.216 0 0 0-.084.012c-.136.037-.632.231-.79.31-.168.084-.208.123-.223.217-.01.056-.002.082.04.138.03.038.071.076.094.086.063.026.172.003.434-.091.468-.169.662-.26.699-.333.054-.105.016-.225-.098-.303a.182.182 0 0 0-.072-.036zm-11.907.008c-.039.006-.065.03-.101.066-.122.122-.096.276.058.354.116.059.466.204.695.288.095.035.203.063.24.064.206.003.304-.242.149-.373-.075-.063-.159-.1-.621-.276-.252-.095-.354-.132-.42-.123z'
                strokeWidth='0.019134'
                />
                <path className='Astro-chart-el'
                d='M.666 11.178c-.051.06-.03.169.052.25.083.083.197.103.254.046l.807-.807v1.683c0 .09.095.164.213.164s.213-.073.213-.164v-1.682l.07.07.737.736c.057.058.17.037.254-.047.084-.083.105-.197.047-.254l-1.066-1.066-.104-.105-.035-.034a.144.144 0 0 0-.113-.04.146.146 0 0 0-.119.04l-.035.034-.104.105-1.066 1.066-.005.005zM52.396 11.253c.051-.06.029-.169-.052-.25-.083-.083-.197-.103-.254-.046l-.807.807v-1.683c0-.09-.095-.164-.213-.164s-.213.073-.213.164v1.682l-.071-.07-.736-.736c-.057-.058-.171-.037-.255.047-.083.083-.104.197-.046.254l1.205 1.205c.03.03.07.042.113.04a.146.146 0 0 0 .119-.04l.475-.475.73-.73.005-.005z'
                strokeWidth='0.18869'
                />
                <path className='Astro-chart-el'
                d='M19.883 15.252c.077.066.218.038.323-.067.108-.108.135-.255.06-.33l-1.321-1.322 1.321-1.321c.075-.075.048-.223-.06-.33-.108-.109-.255-.136-.33-.06l-1.382 1.38-.18.181a.186.186 0 0 0-.05.147.189.189 0 0 0 .05.153l1.562 1.562a.158.158 0 0 0 .007.007z'
                strokeWidth='0.24458'
                />
                <path className='Astro-chart-el'
                d='M.857 13.262c-.121 0-.218.121-.218.271s.097.27.218.27h20.46c.122 0 .22-.12.22-.27s-.098-.271-.22-.271H5.648z'
                strokeWidth='0.2547'
                />
                <rect className='Astro-chart-el'
                x={27.27}
                y={13.262}
                width={1.066}
                height={0.542}
                rx={0.197}
                ry={0.585}
                strokeWidth='0.065521'
                />
                <rect className='Astro-chart-el'
                x={25.22}
                y={13.262}
                width={1.066}
                height={0.542}
                rx={0.197}
                ry={0.585}
                strokeWidth='0.065521'
                />
                <path className='Astro-chart-el'
                d='M33.673 15.252c-.077.066-.218.038-.323-.067-.108-.108-.135-.255-.06-.33l1.321-1.322-1.321-1.321c-.075-.075-.048-.223.06-.33.108-.109.255-.136.33-.06l1.562 1.561c.038.038.054.09.05.147a.189.189 0 0 1-.05.153l-.18.18-1.382 1.382a.158.158 0 0 1-.007.007z'
                strokeWidth='0.24458'
                />
                <path className='Astro-chart-el'
                d='M32.238 13.262c-.121 0-.22.121-.22.271 0 .15.099.27.22.27h19.966c.121 0 .22-.12.22-.27 0-.15-.099-.271-.22-.271H36.535z'
                strokeWidth='0.2547'
                />
                <rect className='Astro-chart-el'
                x={29.402}
                y={13.262}
                width={1.551}
                height={0.542}
                rx={0.197}
                ry={0.585}
                strokeWidth='0.07904'
                />
                <rect className='Astro-chart-el'
                x={22.603}
                y={13.262}
                width={1.551}
                height={0.542}
                rx={0.197}
                ry={0.585}
                strokeWidth='0.07904'
                />
                <g>
                    <text y='87%' className={'Astro-text'}>
                        <tspan x='20%' textAnchor='middle'>{sunrise}</tspan>   
                    </text>
                </g>
                <g>
                    <text y='87%' className={'Astro-text'}> 
                        <tspan x='81%' textAnchor='middle'>{sunset}</tspan>   
                    </text>
                </g>
                <g>
                    <text y='55%' className={'Astro-text'}>
                        <tspan x='50%' textAnchor='middle'>{dayDur}</tspan>   
                    </text>
                </g>
                {polarDay}
            </svg>
        </div>
    );
  }
  export default SunChart;